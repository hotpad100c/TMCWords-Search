<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TechMC Glossary Search</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { padding: 5px; width: 600px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    td, th { border: 1px solid #ccc; padding: 8px; }
    .no-result { text-align:center; color:#888; }
  </style>
</head>
<body>
  <h1>TechMC Glossary Search</h1>
  <input type="text" id="searchBox" placeholder="Keywords..." />
  <table id="resultTable">
    <thead>
      <tr>
        <th>Short Form</th>
        <th>Full Form (English)</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let data = [];

    Papa.parse("https://raw.githubusercontent.com/DuskScorpio/TechMC-Glossary/main/TechMC%20Glossary.csv", {
      download: true,
      header: true,
      complete: function(results) {
        data = results.data;
        renderTable(data, "");
      }
    });

    document.getElementById("searchBox").addEventListener("input", function() {
      const keyword = this.value.toLowerCase();
      if (!keyword) {
        renderTable(data, "");
      } else {
        const filtered = data.filter(row =>
          Object.values(row).some(v => v && v.toLowerCase().includes(keyword))
        );
        renderTable(filtered, keyword);
      }
    });

    function highlight(text, keyword) {
      if (!text) return "";
      if (!keyword) return text;
      const regex = new RegExp(`(${keyword})`, "gi");
      return text.replace(regex, "<mark>$1</mark>");
    }

    function makeCell(text, fallback, colorIfMissing, keyword) {
      if (!text) return `<td style="background-color:${colorIfMissing};">${fallback}</td>`;
      return `<td>${highlight(text, keyword)}</td>`;
    }

    function renderTable(rows, keyword) {
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";
      if (rows.length === 0) {
        tbody.innerHTML = `<tr><td colspan="3" class="no-result">No Result</td></tr>`;
        return;
      }
      rows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          ${makeCell(row["Short Form"], "No Short Form", "#ff6961", keyword)}
          ${makeCell(row["Full Form (English)"], "No English FullForm", "#ff6961", keyword)}
          ${makeCell(row["Description"], "No Description", "#ff6961", keyword)}
        `;
        tbody.appendChild(tr);
      });
    }
  </script>
</body>
</html>
